version: '3.9'
services:
    client:
        build:
            context: .
            dockerfile: ./client/Dockerfile
        depends_on:
            - master
        volumes:
            - .:/code
        networks:
            - external
        environment:
            - docker=true

    master:
        build:
            context: .
            dockerfile: ./master/Dockerfile
        volumes:
            - .:/code
        networks:
            - internal
            - external
        ports:
            - 6000:6000
        environment:
            - docker=true

    node-1:
        build:
            context: .
            dockerfile: ./node/Dockerfile
        depends_on:
            - master
        volumes:
            - .:/code
        networks:
            - internal
        ports:
            - 7000:7000
        environment:
            - docker=true
            - port=7000
            - address="node-1:7000"

    node-2:
        build:
            context: .
            dockerfile: ./node/Dockerfile
        depends_on:
            - master
        volumes:
            - .:/code
        networks:
            - internal
        ports:
            - 7001:7001
        environment:
            - docker=true
            - port=7001
            - address="node-2:7001"

networks:
    internal:
        driver: bridge
    external:
        driver: bridge
