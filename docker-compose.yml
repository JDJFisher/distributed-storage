version: '3.9'
services:
    client:
        build:
            context: .
            dockerfile: ./client/Dockerfile
        depends_on:
            - master
        volumes:
            - .:/code
        networks:
            - external
        environment:
            - docker=true

    master:
        build:
            context: .
            dockerfile: ./master/Dockerfile
        volumes:
            - .:/code
        networks:
            - internal
            - external
        ports:
            - 6789:6789
        environment:
            - docker=true

    node-1:
        build:
            context: .
            dockerfile: ./node/Dockerfile
        depends_on:
            - master
        volumes:
            - .:/code
        networks:
            - internal
        ports:
            - 5000:5000
        environment:
            - docker=true
            - address="node-1:5000"

    node-2:
        build:
            context: .
            dockerfile: ./node/Dockerfile
        depends_on:
            - master
        volumes:
            - .:/code
        networks:
            - internal
        ports:
            - 5001:5001
        environment:
            - docker=true
            - address="node-2:5001"

networks:
    internal:
        driver: bridge
    external:
        driver: bridge
